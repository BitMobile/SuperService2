<?xml version="1.0" encoding="utf-8"?>

<c:Screen xmlns:c="BitMobile.ClientModel3.UI" xmlns:s="BitMobile.ValueStack">
  <c:DockLayout CssClass="RootLayout">

    <!-- Добавление верхней панели -->
    <s:Include File="Components\TopInfoComponent.xml" />

    <!-- Tab Bar-->
    <s:Include File="Components\TabBarСomponent.xml" />

    <!-- Main SVL-->
    <c:SwipeVerticalLayout CssClass="EventListMainSVL">

      <s:Push Id="EventListLastDate" Value="$GetDateNowEventList()" />
      <s:Push Id="EventListCurrentDate" Value="$GetDateNowEventList()" />
      <s:Iterator Id="EventList" Value="$GetEvents()">

        <!-- Проверка на необходимость плашки "Сегодня" -->
        <s:If Test="$IsTodayLayoutNeed()">

          <s:If Test="$IsDateEqualsOrLess($EventListCurrentDate, $EventList.startDatePlanDate)">
            <c:HorizontalLayout CssClass="EventListDateHL">
              <c:TextView Text="#todayUpper#" CssClass="EventListDateTV" />
            </c:HorizontalLayout>
            <c:HorizontalLine CssClass="EventListLongBreaker" />
          </s:If>
          <s:Push Id="void" Value="$SetTodayLayoutToFalse()" />
          <s:Push Id="void" Value="$SetTodayBreakerToFalse()" />
        </s:If>
        <!-- Конец проверки на необходимость плашки "Сегодня" -->

        <!-- Проверка на необходимость плашки с датой-->

        <s:If Test="$IsDateEqualsOrLess($EventListCurrentDate, $EventList.startDatePlanDate)">
        </s:If>
        <s:Else>
          <s:If Test="$IsDateChanged($EventListLastDate, $EventList.startDatePlanDate)">
            <c:HorizontalLine CssClass="EventListLongBreaker" />

            <c:HorizontalLayout CssClass="EventListDateHL">
              <c:TextView Text="$DateTimeToDateWithWeekCheck($EventList.startDatePlanDate)" CssClass="EventListDateTV" />
            </c:HorizontalLayout>

            <c:HorizontalLine CssClass="EventListLongBreaker" />
          </s:If>
          <s:Else>
            <s:If Test="$IsTodayBreakerNeed()">
              <s:Push Id="void" Value="$SetTodayBreakerToFalse()" />
            </s:If>
            <s:Else>
              <!--<c:HorizontalLine CssClass="EventListShortBreaker" />-->
            </s:Else>
          </s:Else>
        </s:Else>
        <!-- Конец проверки на необходимость плашки с датой-->


        <c:HorizontalLayout CssClass="EventListItemHL" OnClick="EventListItemHL_OnClick">

          <c:VerticalLayout CssClass="EventListTimeVL">
            <c:TextView Text="10.00" CssClass="EventListTimeTV" />
            <c:TextView Text="9 мин." CssClass="EventListCounterTV" />
          </c:VerticalLayout>

          <c:VerticalLayout CssClass="EventListStatusVL">
            <c:VerticalLayout CssClass="EventListLineBeforeVL" />

            <s:If Test="$EventList.ImportanceName == Standart">
              <c:Image CssClass="EventListStatusIMG" Source="$GetResourceImage(tasklist_done)" />
            </s:If>
            <s:If Test="$EventList.ImportanceName == High">
              <c:Image CssClass="EventListStatusIMG" Source="$GetResourceImage(tasklist_notdone)" />
            </s:If>
            <s:If Test="$EventList.ImportanceName == Critical">
              <c:Image CssClass="EventListStatusIMG" Source="$GetResourceImage(tasklist_specdone)" />
            </s:If>

            <c:VerticalLayout CssClass="EventListLineAfterVL" />
          </c:VerticalLayout>

          <c:VerticalLayout CssClass="EventListDescriptionVL">
            <c:TextView Text="$EventList.Description" CssClass="EventListItemName" />
            <c:TextView Text="$EventList.Address" CssClass="EventListItemAddress" />
            <c:TextView Text="$EventList.TypeDeparture" CssClass="EventListItemType" />

            <!-- Проверка на необходимость брейкера-->
            <s:If Test="$IsDateChanged($EventListLastDate, $EventList.startDatePlanDate)">
              <!--<c:HorizontalLine CssClass="EventListShortBreaker" />-->
            </s:If>
            <s:Else>
              <c:HorizontalLine CssClass="EventListShortBreaker" />
              <s:If Test="$IsTodayBreakerNeed()">
              </s:If>
              <s:Else>
                <!--<c:HorizontalLine CssClass="EventListShortBreaker" />-->
              </s:Else>
            </s:Else>
            <!--Конец проверки на необходимость брейкера-->

            <!--<c:HorizontalLine CssClass="EventListShortBreaker" />-->
          </c:VerticalLayout>

        </c:HorizontalLayout>

        <s:Push Id="EventListLastDate" Value="$DateTimeToDate($EventList.startDatePlanDate)" />

      </s:Iterator>
    </c:SwipeVerticalLayout>

  </c:DockLayout>
</c:Screen>